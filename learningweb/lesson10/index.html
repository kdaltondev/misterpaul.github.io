<!DOCTYPE html>
<html>
<head>
  <title>Plastics</title>
  <link rel="stylesheet" type="text/css" href="index.css">

  <script>
    let version = 25
    let crushTime = 5000 // time to completely crush bottle (milliseconds)
    let crushStart

    function pageInit () {
        // globals. maybe modify the page objects instead, or make these local and pass them as args
        boot        = document.getElementById('boot')
        boot.style.visibility = 'hidden'
        bottle      = document.getElementById('water-bottle')
        bottle.minSize     = 4  // min size of bottle when crushed

        bottle.initialTop = bottle.offsetTop
        bottle.initialLeft = bottle.offsetLeft
        bottle.initialSize = bottle.height
        bottle.bottom = bottle.initialTop + bottle.height

        boot.initialTop = boot.offsetTop
        boot.bottom = boot.initialTop + boot.height
        boot.verticalDistance =  bottle.bottom - bottle.minSize - (boot.initialTop + boot.height)
        console.log("bootTop: " + boot.initialTop + ", boot bottom: " + boot.bottom + ", bottle.top: " + bottle.initialTop + ", bottle bottom: "+ bottle.bottom)
        console.log("vertDist: " + boot.verticalDistance + ", bottle.bottom: " + bottle.bottom + ", bottle.minSize: " + bottle.minSize + ", boot top: " + boot.initialTop + ", height: " + boot.height + ", diff: " + (bottle.bottom - bottle.minSize - (boot.initialTop + boot.height)))
        boot.verticalMoveRate = boot.verticalDistance / crushTime  // pixels per millisecond

        boot.reposition = function ( t ) { 
            // distance to move is the lesser of the calculated distance, or the max distance
            let dist = Math.min(boot.verticalMoveRate * t, boot.verticalDistance)
            boot.style.transform = 'translateY(' + dist + 'px)'
            boot.bottom = boot.initialTop + dist + boot.height
            console.log( "dist: " + dist + ", boot.top: " + boot.offsetTop + ", boot.bottom:" + boot.bottom)
        }

        bottle.rescale = function () { 
            // yeah, this next line is confusing and should probably be if/then statements
            // let size = Math.max(Math.min(bottle.bottom - boot.bottom, bottle.height), bottle.minSize)
            let size, deltaY
            if (bottle.bottom - boot.bottom >=bottle.height) {
                // boot has not yet touched the bottle
                size = bottle.height
                deltaY = 0
            } else if (bottle.bottom - boot.bottom <= bottle.minSize ) {
                // stop crunching
                size = bottle.minSize
                deltaY = boot.bottom - bottle.minSize
            } else {
                // we're in the midst of crunching
                size = bottle.bottom - boot.bottom
                deltaY = bottle.initialSize - size
            }
            console.log( "scale: " +  size/bottle.initialSize + ", bottle.bottom: " + bottle.bottom +", boot.bottom: " + boot.bottom + ", diff: " + (bottle.bottom - boot.bottom) + ", bottle.height: " + bottle.height + ", bottle.minSize: " + bottle.minSize)           
            //bottle.style.transform = 'scale(' + (size/bottle.initialSize) + ',' +  (size/bottle.initialSize) + ') translateY(' + (bottle.initialSize - size) + 'px)'
            bottle.style.transform = 'translateY(' + deltaY + 'px) scale(' + (size/bottle.initialSize) + ',' +  (size/bottle.initialSize) + ')'
        }

    }

    function moveBoot ( timestamp ) {
        let keepGoing = false
        let bootTop, bottleSize

        if (crushStart === undefined) {
            crushStart = timestamp
        }
        const elapsed = timestamp - crushStart;
        console.log("elapsed: " + elapsed)

        boot.reposition( elapsed )
        bottle.rescale()

        if (elapsed < crushTime) {
            window.requestAnimationFrame ( moveBoot )
        }
    }

    function crushIt () {
        //TODO: initialize boot & bottle (set position & scale) so you can re-run the animation
 
        alert("Perhaps we should crush the bottle first...")
        boot.style.visibility='visible'
        window.requestAnimationFrame ( moveBoot )

    }

    </script>      
</head>
<body onload="pageInit()"> 
    <b>Scaling!</b>
    <div class="outer-box">
        <div class="inner-box">
            <div class="bottles_in_a_ton">
                <table>
                    <tr>
                        <td align="bottom">
                            <img src="../images/boot-svgrepo-com.svg" alt="Boot SVG" title="Boot SVG" class="boot" id="boot"><br>
                            <img src="../images/water-bottle-svgrepo-com.svg" alt="Water Bottle SVG" title="Water Bottle SVG" class="water-bottle" id="water-bottle"><br>
                            This is a 1-liter water bottle. It contains about 23 grams of plastic.
                        </td>
                        <td align="bottom">
                            <img src="../images/dumpster-svgrepo-com.svg" alt="Dumpster SVG" title="Dumpster SVG" class="dumpster" id="dumpster"><br>
                            This is a dumpster. Lets fill it with a ton of plastic. That's <em>39,443</em> 1-liter water bottles.... 
                            <button type="button" class="learn" id="fill_it" onclick="crushIt()">Fill It!</button>
                        </td>
                    </tr>
                </table>
                

            </div>
        </div>
        <div class="lesson">
            Learn about plastic  
            <ol>
                <li>Most discussions of plastic talk about tons of plastic. How many plastic bottles are in a ton of plastic? <button type="button" class="learn">Find Out!</button></li>
            </ol> 
        </div>
    </div>

</body>
</html>